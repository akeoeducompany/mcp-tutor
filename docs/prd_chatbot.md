# 다중 회차(멀티턴) 챗봇 구현 시 고려 사항

> 본 문서는 20분 동안 AI 챗봇이 1:1 교육을 제공하는 서비스를 설계할 때, **멀티턴(Multi-turn) 대화**를 안정적이고 효과적으로 구현하기 위해 꼭 확인해야 할 기술·경험적 포인트를 정리한 가이드입니다.

## 1. 대화 구조 & 흐름 관리

- **세션 타임라인 정의**: 20 분을 ① 아이스브레이킹 → ② 목표 재확인 → ③ 학습/실습 루프(5-7 분 × 2~3) → ④ 요약 & 과제 제시로 구획화해 각 턴의 목적을 명확히 설정.
- **시나리오 vs. 자유 대화 하이브리드**: 핵심 학습 목표는 시나리오로 가이드하되, 학습자 질문에는 자유 응답을 허용해 자연스러움 확보.
- **대화 상태(State) 머신 설계**: `intro`, `teaching`, `practice`, `feedback`, `wrap-up` 등 상태로 나누고, 각 상태 전환 조건(시간, 학습자 발화, 평가 결과)을 명시.

## 2. 컨텍스트 유지 & 메모리 전략

- **대화 요약 버퍼**: 발화 내용을 압축 요약하여 LLM 입력 토큰을 절감하면서 문맥 유지.
- **주제별 키-밸류 메모리**: `problem → 학습자 코드`, `mistake → 교정 피드백` 등 핵심 데이터를 구조화해 빠르게 조회.
- **개인화 프로필**: 학습자의 사전 수준, 선호 학습 스타일을 세션 시작 시 메모리에 적재하여 적응형 피드백 제공.

## 3. 학습 목표 정렬 & 평가 루프

- **턴 단위 마이크로 목표**: 각 3-5 턴마다 "개념 설명 → 이해 확인 → 적용" 미니 루프를 돌려 집중도 유지.
- **즉각적 진단**: 학습자 코드 실행 결과나 퀴즈 응답을 실시간 평가하여 다음 턴 난이도 조정.
- **메타 피드백**: "이번 답변은 부분적으로 맞았습니다. 이유는 …"처럼 사고 과정을 노출해 메타인지 촉진.

## 4. 사용자 발화 처리

- **의도 & 슬롯 추출**: 학습 요청, 오류 보고, 잡담 등을 분류하여 적절한 시스템 액트 결정.
- **오류 패턴 분석**: 반복되는 실수(예: 오프-바이-원) 탐지 후 패턴 기반 피드백.
- **탐색적 질문**: 학습자 답변이 짧거나 모호할 때 열린 질문을 던져 정보 수집.

## 5. 시스템 응답 생성

- **TIERed Response Template**
  1. 짧은 요약(1-2 줄)
  2. 상세 설명 & 예시 코드
  3. 추가 자료(링크, 다이어그램)
- **토큰 한계 대비 단계적 출력**: 길이가 긴 설명은 "1/2", "2/2"로 분할하여 전달.
- **톤 & 레벨 컨트롤**: Bloom's Taxonomy 단계(이해→적용→분석)를 태그로 전달해 LLM 출력 레벨 제어.

## 6. 회화 품질 모니터링

- **실시간 토픽 추적**: 목표 주제에서 벗어나면 자동 리루트(re-route) 프롬프트 삽입.
- **Toxicity / Bias 필터**: 학습자 생성 콘텐츠가 부적절할 때 정중히 제지하고 안전 모드 전환.
- **Latency SLA**: 2-3 초 이내 최초 답변, 5 초 이내 전체 응답을 목표로 캐싱·스트리밍 적용.

## 7. 기술 스택 제안

| 레이어 | 추천 기술 | 비고 |
| --- | --- | --- |
| 대화 관리 | LangChain / LlamaIndex + Redux/State machine | 턴 상태, 메모리, 툴 호출 래핑 |
| LLM 인퍼런스 | OpenAI GPT-4o / Anthropic Claude 3 | 툴 콜 기능, 길이 제약 대응 |
| 실시간 스트리밍 | Server-Sent Events(SSE) / WebSocket | 토큰 단위 스트리밍 UX |
| 평가 & 로그 | Elasticsearch + Kibana | 발화, 피드백, 성취 데이터 분석 |

## 8. 향후 확장 고려

- **멀티모달 입력**: 코드 스니펫 + 스크린샷 이해.
- **지속 학습**: 세션 간 프로그레스 메모리로 장기 퍼스널라이즈.
- **에이전트 툴링**: 자동 코드 실행, 테스트 케이스 생성, 오류 디버깅까지 에이전트 체인으로 위임.

---
**요약**: 20 분 챗봇 교육 세션의 멀티턴 구현은 "맥락 지속", "미세 목표 루프", "온디맨드 적응형 피드백"이 핵심입니다. 상기 체크리스트를 충족하면 학습자는 흐름을 끊지 않고 몰입해 목표를 달성할 수 있습니다.
